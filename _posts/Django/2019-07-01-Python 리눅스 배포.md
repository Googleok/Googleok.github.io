---
layout: post
title: Django Python ë¦¬ëˆ…ìŠ¤ ë°°í¬
published: True
category: Django
permalink: /Django/:year/:month/:day/:title/
tags: [Django, python, Linux]
comments: true
---

# Python ë¦¬ëˆ…ìŠ¤ ë°°í¬ ğŸšš
<hr>

### ëª©ì°¨

>	1. Linux Python Env ( 3.5 )
>	2. Python Virtual Environment (isolation)
>	3. Packaging
>	4. Apache - django

<br>

### 1. Python ì„¤ì¹˜ (CentOS 6.9 ì„¤ì¹˜)

<hr>

#### 1-1 ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸

```
# yum -y install openssl
# yum -y install openssl-devel
# yum -y install bzip2-devel
# yum -y install sqlite-devel
# yum -y install zlib-devel
# yum -y install libffi-devel
```


```
openssl (1.0, 1.2 ) -------------> ...
                  |
                  | -------------> libressl  --> 2.1 --> 2.6.4 --> 2.9....
                                                                  (python 3.7)

3.7.x ë²„ì „ì—ì„œëŠ” libressl 2.6.4 more ê°€ í•„ìš”í•˜ë‹¤
```


##### 1-1 ì†ŒìŠ¤ ë‹¤ìš´

```
# wget https://ftp.openbsd.org/pub/OpenBSD/LibreSSL/libressl-2.9.2.tar.gz
```

##### 1-2 ë¹Œë“œ í™˜ê²½ ì„¤ì •

```
# ./configure -prefix=/usr/local/ssl
```

##### 1-3 ì»´íŒŒì¼ ë° ì„¤ì¹˜

```
# make && make install
```

##### 1-4 ê³µìœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìë™ ë¡œë”© ì„¤ì •

```
# vi /etc/ld.so.conf.d/ssl.conf
    /usr/local/ssl/lib

ê³µìœ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸ ëª…ë ¹ ==  ldconfig -v
```

##### 1-5 í™•ì¸

```
# ldconfig -v | grep ssl
```
<br>
<hr>
<br>

#### 1-2 Python 3.73 ì„¤ì¹˜
<br>

##### 2-1 ë‹¤ìš´ë¡œë“œ

```
wget https://www.python.org/ftp/python/3.7.3/Python-3.7.3.tgz
```

##### 2-2 í™˜ê²½ ì„¤ì •

```
./configure --prefix=/usr/local/cafe24/python3.7.3 --with-openssl=/usr/local/ssl --enable-shared
```

##### 2-3 ì»´íŒŒì¼

```
make && make install
```

##### 2-4 ê³µìœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì„¤ì •

```
# vi /etc/ld.so.conf.d/python.conf
    /usr/local/cafe24/python3.7.3/lib
# ldconfig -v | grep python
# cd /usr/local/cafe24
# ln -s python3.7.3 python3.7
```

##### 2-5 Python3.7.3 Path ë“±ë¡

```
# vi /etc/profile
#python 3.7
export PATH=$PATH:/usr/local/cafe24/python3.7/bin
ë“±ë¡
```

##### 2-6 ìˆ˜ì •í•œ ì½”ë“œ ì ìš©ì‹œí‚¤ê¸°

```
# source /etc/profile
```
<br>
### 2. Python Isolation Tools ( Virtual Environments )
<br>
#### ëª©ì°¨

> 1. venv				: python3.3 ë²„ì ¼ ì´í›„, ë¶€í„° ê¸°ë³¸ëª¨ë“ˆ
> 2. virtualenv	: python2 ë¶€í„° ì‚¬ìš©í•´ì˜¤ë˜ ê°€ìƒí™˜ê²½ ê³µìœ ë¼ì´ë¸ŒëŸ¬ë¦¬
> 3. pyenv		  : Python Interpretor Version Manager
> 4. conda			: Anaconda Python ì„¤ì¹˜í–ˆì„ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
> 5. etc				: virtualenvwrapper, buildout.....

<br>

#### 2-1 virtualenv ì„¤ì¹˜

##### 1. ì„¤ì¹˜

```
# pip install virtualenv
```

##### 2. í”„ë¡œì íŠ¸ ìƒì„±

```
# mkdir loganalysis
```

##### 3. ê°€ìƒí™˜ê²½ ìƒì„±

```
# cd loganalysis
# virtualenv venv
```

##### 4. ê°€ìƒí™˜ê²½ êµ¬ë™

```
# source venv/bin/activate
```

##### 5. í™•ì¸

```
(venv) # python --Version
```

##### 6. ê°€ìƒí™˜ê²½ íƒˆì¶œ

```
(venv) # deactivate
```

<br>

#### 2-2 python -m venv venv


#### 2-3 ê°„ë‹¨í•œ postgres ì—°ê²° ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ í•´ë³´

```
cf ) postgres < 10.8 ì¸ ê²½ìš° ë‹¤ìŒì‚¬í•­ í™•ì¸
		# cd /usr/lib64
		# rm libpq.so.5
		# ln -s /usr/local/cafe24/pgsql/lib/libpq.so.5 libpq.so.5
```

#### 2-4 pgsql_crud í”„ë¡œì íŠ¸ í…ŒìŠ¤íŠ¸

> ë¡œì»¬ì—ì„œ ê°œë°œí•˜ê³  í…ŒìŠ¤íŠ¸í•˜ê³  ê¹ƒì— ì˜¬ë¦¬ëŠ”...

1. pycharmì—ì„œ pgsql_crud í”„ë¡œì íŠ¸ ìƒì„±

2. github commit

	venv ë° .idea( í”„ë¡œì íŠ¸ ì„¤ì • íŒŒì¼ ) ì€ ignore

3. íŒ¨í‚¤ì§€ ì˜ì¡´ì„± íŒŒì¼ ìƒì„±

	pip freeze > requirements.txt

4. linux ì—ì„œ git clone ìƒì„±

5. venv ìƒì„± (isolationize)

```
	# virtualenv venv
	# source venv/bin/activate
```

<b style="color:red;">venv í™˜ê²½ì—ì„œ ì„¤ì¹˜ë¥¼ í•´ì•¼ì§€ ê·¸ í´ë”ì—ë§Œ ì ìš©ë¨
ê·¸ë ‡ê²Œ í•˜ì§€ ì•Šìœ¼ë©´ rootì— ë‹¤ ê¹”ë ¤ë²„ë¦°ë‹¤ (í°ì¼ì´ë‹¤!!!)
</b>

6. ì˜ì¡´ì„± ì„¤ì¹˜

```
(venv) # pip install -r requirements.txt
```

7. ì‹¤í–‰

```
(venv) # python test_crud.py
```

#### 2-5. test_crud.py ë¥¼ ê³ ë¦½ì‹œí‚¤ì§€ ì•Šê³  (venvë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ ) ì‹¤í–‰

> ê°œë°œëœ íŒŒì´ì¬ ì†ŒìŠ¤ë¥¼ ë‹¤ìš´ë°›ì•„ì„œ ì‹¤í–‰......
> python3 pgsql_crud/test_crud.py ì´ë ‡ê²Œ ì‹¤í–‰í•´ë„ ë ë ¤ë©´

```
import sys
print(sys.path)
sys.pathì— ì•„ë˜ì½”ë“œê°€ ë“±ë¡ ë˜ì–´ìˆì–´ì•¼ í•œë‹¤.
/root/dowork/python-projects/pgsql_crud/venv/lib/python3.7/site-packages

==> ë“±ë¡í•˜ê¸°
# export PYTHONPATH='/root/dowork/python-projects/pgsql_crud/venv/lib/python3.7/site-packages'
```

#### 2-6 python_crawler project test

1) ì ì§„ì  ì˜ì¡´ì„± ì²´í¬ í™•ì¸í•´ë³´ê¸°

python3 zipapp -p "/usr/bin/cafe24/python3.7/bin/python3" python_crawler

python3 zipapp python_crawler

python_crawler.pyz

python3 python_crawler.pyz

./python_crawler.pyz


```
.gitignore ìƒì„±
.idea/
venv/

# git rm -r --cached
# git add .
# git commit -m ""
# git push origin master
```

1. python ì„¤ì¹˜ ì‹œ, python application ì‹¤í–‰ (venv ì•„ë‹Œìƒí™©)

- 1.1 export PYTHONPATH='application ì˜ì¡´ì„± ê²½ë¡œ'

ex)
```
# git clone https://....
# pip3 install -r python_crawler/requirements.txt --target=python_crawler/packages
# export PYTHONPATH='/root/python-projects/python_crawler/packages'

#python3 python_crawler
```

- 1.2 ê¼­ export PYTHONPATH ë¥¼ í•´ì•¼ë¼?

ex)

```
# git clone https://....
# pip3 install -r python_crawler/requirements.txt --target=python_crawler
# python3 python_crawler
```

- 1.3 ì••ì¶• (Packaging)
-> ì§„ì§œëŠ” ì´ê±°ë‹¤!

ex)

```
# git clone https://....
# pip3 install -r python_crawler/requirements.txt --target=python_crawler

# python3 -m zipapp python_crawler
# python3 python_crawler.pyz
```

1.4 ì‹¤í–‰ ê°€ëŠ¥í•œ íŒŒì¼ë¡œ Packaging í•˜ê¸°

ex)

```
# git clone https://....
# pip3 install -r python_crawler/requirements.txt --target=python_crawler

# python3 -m zipapp -p "/cafe24/python3.7/bin/python3" python_crawler
# python_crawler.pyz
```

```
                                          /helloworld
HTTP -> [8080:tomcat-cafe24(server.xml)] <------->
                                            AJP      [:apache(httpd.conf):80] <- HTTP
                                         <------->
                                          /mysite2

HTTP -> [9090:tomcat-jenkins(sever.xml):9009]                          
                                                    [:apache:8888] <- HTTP
                                     (mod_wsgi)ëª¨ë“ˆì„¤ì¹˜    | (execute)
                                                         WSGI
                                                          |
                                                    django App's wsgi.py


```

apache vhost ì„¤ì •
- ë„ë©”ì¸ ê¸°ì¤€(ê°™ì€ í¬íŠ¸, ë‹¤ë¥¸ ë„ë©”ì¸)
- í¬íŠ¸ ê¸°ì¤€  (ë‹¤ë¥¸ í¬íŠ¸, ê°™ì€ ë„ë©”ì¸) : apache ë©€í‹°í¬íŠ¸ ì„œë¹„ìŠ¤

1. httpd.com

1)
    Listen 80
    Listen 8888 (ì¶”ê°€)

2) DocumentRoot ë””ë ‰í† ë¦¬ ê¶Œí•œ ì„¤ì • ì£¼ì„ì²˜ë¦¬

```
	#<Directory "/usr/local/cafe24/apache/htdocs">
	#    Options Indexes FollowSymLinks
	#    AllowOverride None
	#    Order allow,deny
	#    Allow from all
	#</Directory>
```

3) vhost ì„¤ì • íŒŒì¼ ì£¼ì„ ì—†ì•°

```
# Virtual hosts
Include conf/extra/httpd-vhosts.conf
```

4) httpd-vhosts.conf ì„¤ì •

```
 conf/extra/httpd-vhosts.conf ì—¬ê¸°ì— ìˆ˜ì •


     vi /apache/conf/extra/httpd-vhosts.conf ì´ì œ ì¼ë¡œ ë‹¤ ìš”ì²­ì´ ë“¤ì–´ê°€ë‹ˆê¹ ì´ê±¸ ìˆ˜ì •í•´ì•¼í•œë‹¤

     NameVirtualHost *:8888 ì¶”ê°€

     <80>
     <Directory "/usr/local/cafe24/apache/htdocs">
                 Options Indexes FollowSymLinks
                 AllowOverride None
                 Order allow,deny
                 Allow from all
     </Directory>

     <8888>
      <Directory "/home/django/python_ch3">
           Options Indexes FollowSymLinks
             AllowOverride None
             Order allow,deny
             Allow from all
     </Directory>


/etc/init.d/httpd stop

```

apache - django ì—°ë™ í•˜ê¸°

1. mod_wsgi ì„¤ì¹˜

```
# wget https://github.com/GrahamDumpleton/mod_wsgi/releases/tag/4.6.4
# ./configure --with-apxs=/usr/local/cafe24/apache/bin/apxs --with-python=/usr/local/cafe24/python3.7/bin/python3
# make && make install
```

2. ì„¤ì •

  1. httpd.configure

    ëª¨ë“ˆ ë¡œë”©
    LoadModule wsgi_module modules/mod_wsgi.so

  2. httpd-vhost.conf
